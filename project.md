# 项目开发日志

>V2.0版本:

项目架构:

- express提供web服务
- bluebird提供Promise
- seuqelize执行sql原始查询
- 根据请求生成调用logic生成文字结果对象

## 项目日记

2017-04-13:

- 新增JSON读写模块；
- 修改算法：删除日报购进的累计统计；

2017-04-12:

- 新增库存日报表小数位数参数；
- 暂时将“磷矿石”加入化肥类的“其它”中，因为报表需求累计数；
- 修改销售日报表年累计数的小数位数；
- 修改打印格式；

2017-04-11:

- 修复富钙和磷酸分类错误问题;
- 修复销售日报中同期比算法错误问题;
- 修复route.params路由问题;

2017-04-08:

- 现在已经把打印功能彻底从逻辑中分离出来
- github提交老是出问题？解决了，先`git pull`，然后在`git push -f`，将本地的将行覆盖远程分支上。

2017-04-06：

- coding上的repo终于同步到github上了，用到了一个命令：`git pull origin master --allow-unrelated-histories`
- 新建了utils模块名，将公用的静态方法全部从logic中提取出来，方便以后复用
- 加入了winston的express中间件，方便以后在pm2上线时记录错误

2017-04-05:

- 目前日报表库存部分已经重构完毕。之前的算法是算法函数直接把所有结果生成对象传递给打印模板直接打印，但问题是查询arr原始数据次数过多，会造成一定性能损失，故决定在重构采购和销售日报表算法时，解决这个问题。打印模板做一些适当的逻辑操作，以增加性能；
- 写到打印模板时，发现还得写一个统计结果类才行嘛。在logic统计出的对象结果直接解构赋值给这个对象！管他的，先在打印模板中把这个类写出来再新建文件。

2017年04月04日化肥进销存：
一、购进：化肥总购入0吨，0万元。其中。2017年累计购入101021吨，同比增长96%；累计购额15963万元，同比增长88%（以采购入库单统计）。
二、销售：化肥总售出41吨，9万元。其中尿素31吨(工农尿素[40kg，46.4%]31吨,单价1860),硫酸钾10吨。2017年累计销售99078吨，同比增长30%；累计销额15378万元，同比增长41%（以销售出库单统计）。
三、库存：全公司化肥库存124829吨。
    其中1、分公司库存59667吨（曲靖分公司4584吨,大理分公司18473吨,开远分公司12060吨,滇中分公司11485吨,楚雄分公司13066吨,农药分公司0吨），
            尿素39112吨（曲靖分公司2561吨,大理分公司13716吨,开远分公司9568吨,滇中分公司6361吨,楚雄分公司6906吨顿，
                其中工农螯合钾锌尿素622吨,象牌尿素179吨,天华尿素987吨,宜化尿素145吨,816螯合钾锌硼尿素268吨,工农尿素14158吨,天华螯合钾锌尿素48吨,工农螯合锌硼硅尿素0吨,财神尿素10吨,丰喜多肽尿素26吨,汇东尿素1吨,丰喜缓释尿素9吨,美丰多肽尿素191吨,美丰尿素3062吨,解化尿素2吨,湖光尿素7820吨,工农禾谷素尿素2吨,云化尿素2647吨,金象微时代尿素327吨,蜀龙尿素10吨,华锦尿素813吨,富岛尿素0吨,华山尿素0吨,工农锌腐酸尿素1264吨,湖光增效尿素20吨,四面山尿素19吨,川化尿素2吨,裕农尿素82吨,美丰黄金肽尿素100吨,816螯合钾加锌尿素 187吨,东风尿素1吨,润飞尿素258吨,丰喜尿素5849吨），
            低含量5221吨,碳铵128吨,高含量6630吨,硫酸钾镁641吨,钙镁158吨,普钙680吨,硫酸钾2074吨,硝磷铵1406吨,磷铵112吨,氯化钾2686吨,硫铵0吨,重钙695吨，其它125.0874吨（明月47吨,金满田33吨,纳若夏19吨,硝酸钾27吨）。
        2、进出口部库存65162吨（磷铵41108吨,尿素44吨,重钙21080吨,磷酸2929吨）。


*！购进不要累计！OK!!!!
*！销售里尿素明细物料排列顺序
*！库存里尿素明细物料排列顺序
*！尿素明细物料排列顺序