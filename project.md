# 项目开发日志

>V2.0版本:

项目架构:

- express提供web服务
- bluebird提供Promise
- seuqelize执行sql原始查询
- 根据请求生成调用logic生成文字结果对象

## 项目日记

2017-04-23:

- 修复：库存日报小数点位数问题；
- 修复：销售和购进报表中尿素排序问题已解决；

2017-04-14:

- 想法：目前项目仅合适自己公司需求，没有值得开源的地方。以后将仿Tableau的功能，用JavaScript实现其功能，然后输入写成脚本式的，核心算法进行分析后输出json。
- 构想：新项目名：Portable-EAS。该项目分为前端、后端和权限系统三个部分。其中前端vuejs或react实现，后端和权限系统为express或koa或loopback实现。前端发请求，到权限系统，再到后端。

2017-04-13:

- 新增JSON读写模块；
- 修改算法：删除日报购进的累计统计；

2017-04-12:

- 新增库存日报表小数位数参数；
- 暂时在EAS中将“磷矿石”加入化肥类的“其它”中，因为报表需求累计数；
- 修改销售日报表年累计数的小数位数；
- 修改打印格式；

2017-04-11:

- 修复富钙和磷酸分类错误问题;
- 修复销售日报中同期比算法错误问题;
- 修复route.params路由问题;

2017-04-08:

- 现在已经把打印功能彻底从逻辑中分离出来
- github提交老是出问题？解决了，先`git pull`，然后在`git push -f`，将本地的将行覆盖远程分支上。

2017-04-06：

- coding上的repo终于同步到github上了，用到了一个命令：`git pull origin master --allow-unrelated-histories`
- 新建了utils模块名，将公用的静态方法全部从logic中提取出来，方便以后复用
- 加入了winston的express中间件，方便以后在pm2上线时记录错误

2017-04-05:

- 目前日报表库存部分已经重构完毕。之前的算法是算法函数直接把所有结果生成对象传递给打印模板直接打印，但问题是查询arr原始数据次数过多，会造成一定性能损失，故决定在重构采购和销售日报表算法时，解决这个问题。打印模板做一些适当的逻辑操作，以增加性能；
- 写到打印模板时，发现还得写一个统计结果类才行嘛。在logic统计出的对象结果直接解构赋值给这个对象！管他的，先在打印模板中把这个类写出来再新建文件。


2017年04月21日化肥进销存：
一、购进：化肥总购入168吨，24万元。其中湖光尿素[46%,40kg]120吨,单价1650,勤丰普钙[16%，50kg]30吨,单价410,仁恒复合肥[10-10-10,30%,40kg,通用肥]18吨,单价1380,。
二、销售：化肥总售出3556吨，644万元。
    其中尿素1338吨(工农尿素[40kg，46.4%]1090吨,单价1764,云化尿素[46%，小颗粒,40kg]51吨,单价1927,湖光尿素[46%,40kg]132吨,单价1775,天华尿素[46.4%，40kg(中颗粒)]20吨,单价1710,美丰尿素[46%，40kg]45吨,单价1850),碳铵120吨,硝磷铵1吨,普钙65吨,钙镁4吨,氯化钾1996吨,高含量30吨,低含量1吨,复合肥30吨。2017年累计销售148829吨，同比增长54%；累计销额20614万元，同比增长51%（以销售出库单统计）。
三、库存：全公司化肥库存113898吨。
    其中1、分公司库存48754吨（曲靖分公司3934吨,大理分公司13038吨,开远分公司8185吨,滇中分公司11184吨,楚雄分公司12412吨,农药分公司0吨），
            尿素27472吨（曲靖分公司1940吨,大理分公司8229吨,开远分公司5994吨,滇中分公司5190吨,楚雄分公司6119吨顿，其中工农螯合钾锌尿素611吨,象牌尿素25吨,天华尿素742吨,宜化尿素145吨,816螯合钾锌硼尿素262吨,工农尿素7017吨,天华螯合钾锌尿素43吨,工农螯合锌硼硅尿素0吨,财神尿素10吨,丰喜多肽尿素26吨,汇东尿素1吨,丰喜缓释尿素9吨,美丰多肽尿素161吨,美丰尿素2236吨,解化尿素0吨,湖光尿素7092吨,工农禾谷素尿素2吨,云化尿素1953吨,金象微时代尿素665吨,蜀龙尿素10吨,华锦尿素725吨,富岛尿素0吨,华山尿素0吨,工农锌腐酸尿素1247吨,湖光增效尿素20吨,四面山尿素19吨,川化尿素2吨,裕农尿素23吨,美丰黄金肽尿素100吨,816螯合钾加锌尿素 170吨,东风尿素1吨,润飞尿素114吨,丰喜尿素4040吨），
            低含量4818吨,碳铵286吨,高含量6332吨,硫酸钾镁603吨,钙镁168吨,普钙871吨,硫酸钾2856吨,硝磷铵1766吨,磷铵112吨,硫铵0吨,氯化钾2658吨,重钙695吨，其它116吨（明月49吨,金满田32吨,纳若夏19吨,硝酸钾17吨）。
        2、进出口部库存65145吨（磷铵41108吨,尿素44吨,磷酸2912吨,重钙21080吨）。


*！购进不要累计！OK!!!!
*！销售里尿素明细物料排列顺序 ok!!!!
*！库存里尿素明细物料排列顺序 ok!!!!
*！尿素明细物料排列顺序
