# 项目开发日志

>V2.0版本:

项目架构:

- express提供web服务
- bluebird提供Promise
- seuqelize执行sql原始查询
- 根据请求生成调用logic生成文字结果对象

## 项目日记

2017-04-24:

- 更新：日报购销化肥大类分析算法重构完成，但复合肥需修复；
- 更新：日报界面增加统计的起至时间；

2017-04-23:

- 修复：库存日报小数点位数问题；
- 修复：销售和购进报表中尿素排序问题已解决；
- 新增：sqlCommand加入FFertGroupID字段显示物料化肥大类ID，可用于排序，解耦。

2017-04-14:

- 想法：目前项目仅合适自己公司需求，没有值得开源的地方。以后将仿Tableau的功能，用JavaScript实现其功能，然后输入写成脚本式的，核心算法进行分析后输出json。
- 构想：新项目名：Portable-EAS。该项目分为前端、后端和权限系统三个部分。其中前端vuejs或react实现，后端和权限系统为express或koa或loopback实现。前端发请求，到权限系统，再到后端。

2017-04-13:

- 新增JSON读写模块；
- 修改算法：删除日报购进的累计统计；

2017-04-12:

- 新增库存日报表小数位数参数；
- 暂时在EAS中将“磷矿石”加入化肥类的“其它”中，因为报表需求累计数；
- 修改销售日报表年累计数的小数位数；
- 修改打印格式；

2017-04-11:

- 修复富钙和磷酸分类错误问题;
- 修复销售日报中同期比算法错误问题;
- 修复route.params路由问题;

2017-04-08:

- 现在已经把打印功能彻底从逻辑中分离出来
- github提交老是出问题？解决了，先`git pull`，然后在`git push -f`，将本地的将行覆盖远程分支上。

2017-04-06：

- coding上的repo终于同步到github上了，用到了一个命令：`git pull origin master --allow-unrelated-histories`
- 新建了utils模块名，将公用的静态方法全部从logic中提取出来，方便以后复用
- 加入了winston的express中间件，方便以后在pm2上线时记录错误

2017-04-05:

- 目前日报表库存部分已经重构完毕。之前的算法是算法函数直接把所有结果生成对象传递给打印模板直接打印，但问题是查询arr原始数据次数过多，会造成一定性能损失，故决定在重构采购和销售日报表算法时，解决这个问题。打印模板做一些适当的逻辑操作，以增加性能；
- 写到打印模板时，发现还得写一个统计结果类才行嘛。在logic统计出的对象结果直接解构赋值给这个对象！管他的，先在打印模板中把这个类写出来再新建文件。

2017年04月21日化肥进销存：
一、购进：化肥总购入168吨，24万元。其中湖光尿素[46%,40kg]120吨,单价1650,勤丰普钙[16%，50kg]30吨,单价410,仁恒复合肥[10-10-10,30%,40kg,通用肥]18吨,单价1380,。
二、销售：化肥总售出3556吨，644万元。
    其中尿素1338吨(工农尿素[40kg，46.4%]1090吨,单价1764,云化尿素[46%，小颗粒,40kg]51吨,单价1927,湖光尿素[46%,40kg]132吨,单价1775,天华尿素[46.4%，40kg(中颗粒)]20吨,单价1710,美丰尿素[46%，40kg]45吨,单价1850),碳铵120吨,硝磷铵1吨,普钙65吨,钙镁4吨,氯化钾1996吨,高含量30吨,低含量1吨,复合肥30吨。2017年累计销售148829吨，同比增长54%；累计销额20614万元，同比增长51%（以销售出库单统计）。
三、库存：全公司化肥库存113898吨。
    其中1、分公司库存48754吨（曲靖分公司3934吨,大理分公司13038吨,开远分公司8185吨,滇中分公司11184吨,楚雄分公司12412吨,农药分公司0吨），
            尿素27472吨（曲靖分公司1940吨,大理分公司8229吨,开远分公司5994吨,滇中分公司5190吨,楚雄分公司6119吨顿，其中工农螯合钾锌尿素611吨,象牌尿素25吨,天华尿素742吨,宜化尿素145吨,816螯合钾锌硼尿素262吨,工农尿素7017吨,天华螯合钾锌尿素43吨,工农螯合锌硼硅尿素0吨,财神尿素10吨,丰喜多肽尿素26吨,汇东尿素1吨,丰喜缓释尿素9吨,美丰多肽尿素161吨,美丰尿素2236吨,解化尿素0吨,湖光尿素7092吨,工农禾谷素尿素2吨,云化尿素1953吨,金象微时代尿素665吨,蜀龙尿素10吨,华锦尿素725吨,富岛尿素0吨,华山尿素0吨,工农锌腐酸尿素1247吨,湖光增效尿素20吨,四面山尿素19吨,川化尿素2吨,裕农尿素23吨,美丰黄金肽尿素100吨,816螯合钾加锌尿素 170吨,东风尿素1吨,润飞尿素114吨,丰喜尿素4040吨），
            低含量4818吨,碳铵286吨,高含量6332吨,硫酸钾镁603吨,钙镁168吨,普钙871吨,硫酸钾2856吨,硝磷铵1766吨,磷铵112吨,硫铵0吨,氯化钾2658吨,重钙695吨，其它116吨（明月49吨,金满田32吨,纳若夏19吨,硝酸钾17吨）。
        2、进出口部库存65145吨（磷铵41108吨,尿素44吨,磷酸2912吨,重钙21080吨）。

*！购进不要累计！OK!!!!
*！销售里尿素明细物料排列顺序 ok!!!!
*！库存里尿素明细物料排列顺序 ok!!!!
*！尿素明细物料排列顺序  ok !!!!
-------------------------------------

2017年4月28-5月1日化肥进销存：
一、购进：化肥总购入总购入3289吨，401万元。其中尿素2058吨（云化498吨,均单价1834;湖光780吨,均单价1777;工农544吨,均单价1503;锦疆236吨,单价1650）；勤丰普钙[16%]824吨,单价410，[复合肥袋]348吨,单价400，[12%]27吨,均单价310,磷都钙镁磷[12%]32吨,单价600（以采购入库单统计）。

二、销售：化肥总售出6391吨，1029万元。其中尿素4829吨(云化442吨,均单价1904;美丰170吨,单价1850，多肽28吨,单价2101;湖光1827吨,均单价1795;丰喜606吨,单价1747;工农螯合钾锌41吨,均单价1849;工农895吨,均单价1761，[白袋红字 ]377吨,均单价1572;工农锌腐酸24吨,均单价1901;816螯合钾加锌27吨,单价1900;华锦213吨,均单价1766;天华71吨,均单价1797;润飞4吨,单价1820;金象微时代7吨,单价2050;锦疆96吨,均单价1705), 碳铵29吨,硝磷铵149吨,普钙825吨,钙镁64吨,钾肥228吨,复合肥269吨（高含量52吨）（以销售出库单统计）。

三、2017年累计销售：全公司累计销售193789吨，同比增长77%；累计销额28493万元，同比增长84%。其中分公司累计销售126899吨，同比增长22%；累计销额19415万元，同比增长35%。进出口部累计销售66890吨，同比增长1100%；累计销额9078万元，同比增长717%。

四、库存：全公司化肥库存77325吨。其中1、分公司库存35094吨（曲靖3120吨,大理5665吨,开远6332吨,滇中10263吨,楚雄9714吨），尿素16181吨（曲靖1296吨,大理1328吨,开远4128吨,滇中4774吨,楚雄4656吨，其中云化1383吨,解化0吨,汇东1吨,川化2吨,美丰2057吨,湖光2885吨,四面山19吨,蜀龙10吨,宜化145吨,财神10吨,富岛0吨,东风1吨,丰喜3219吨,工农4612吨,816367吨,华锦48吨,天华585吨,润飞3吨,金象645吨,象牌25吨,裕农23吨,锦疆140吨），碳铵85吨,硫铵0吨,硝磷铵1704吨,普钙1207吨,钙镁170吨,磷铵112吨,钾肥5091吨，复合肥10429吨，其它116吨（明月65吨,金满田32吨,纳若夏19吨）。2、进出口部库存42231吨（磷铵41108吨,磷酸188吨,重钙934吨）。

五、农药：2017年累计购进5120万元，同比下降13%；累计销售7382万元，同比增长18%。
---------------

2017年04月28至2017年05月01日化肥进销存：
一、购进：化肥总购入3289吨，401万元。其中云化尿素[46%，小颗粒,40kg]498吨,均单价1834;湖光尿素[46%,40kg]780吨,均单价1777;工农尿素[40kg，46.4%]544吨,均单价1503;锦疆尿素[40kg，46.4% ]236吨,均单价1650,勤丰普钙[16%，50kg]824吨,均单价410;勤丰普钙[16%,50kg,复合肥袋]348吨,均单价400;勤丰普钙[12%，50kg]27吨,均单价310,磷都钙镁磷[12%,40kg]32吨,均单价600。

二、销售：化肥总售出6391吨，1029万元。其中尿素4829吨(云化尿素[46%，小颗粒,40kg]442吨,均单价1904;美丰尿素[46%，40kg]170吨,均单价1850;美丰多肽尿素[46%,40kg,重载膜袋]28吨,均单价2101;湖光尿素[46%,40kg]1827吨,均单价1795;丰喜尿素[46.4%,40kg,小颗粒]606吨,均单价1747;工农螯合钾锌尿素[N≥46%，40kg ]41吨,均单价1849;工农尿素[40kg，46.4%]895吨,均单价1761;工农尿素[40kg，46.4%，白袋红字 ]377吨,均单价1572;工农锌腐酸尿素[40kg，46%]24吨,均单价1901;816螯合钾加锌尿素 [46%,40kg]27吨,均单价1900;华锦尿素[46%，40kg]213吨,均单价1766;天华尿素[46.4%，40kg(中颗粒)]71吨,均单价1797;润飞尿素[46.4%，40kg]4吨,均单价1820;金象微时代尿素[46.0%，40KG]7吨,均单价2050;象牌尿素[46.3%，40kg]1吨,均单价1820;锦疆尿素[40kg，46.4% ]96吨,均单价1705),碳铵29吨,硝磷铵149吨,普钙825吨,钙镁64吨,硫酸钾114吨,氯化钾76吨,硫酸钾镁38吨,高含量52吨,低含量217吨。2017年累计销售195889吨，同比增长79%；累计销额28817万元，同比增长87%（以销售出库单统计）。

三、库存：全公司化肥库存77325吨。其中1、分公司库存35094吨（曲靖分公司3120吨,大理分公司5665吨,开远分公司6332吨,滇中分公司10263吨,楚雄分公司9714吨,农药分公司0吨），尿素16181吨（曲靖分公司1296吨,大理分公司1328吨,开远分公司4128吨,滇中分公司4774吨,楚雄分公司4656吨顿，其中云化1383吨,解化0吨,汇东1吨,川化2吨,美丰2057吨,湖光2885吨,四面山19吨,蜀龙10吨,宜化145吨,财神10吨,富岛0吨,东风1吨,丰喜3219吨,工农4612吨,816367吨,华锦48吨,天华585吨,润飞3吨,金象645吨,象牌25吨,裕农23吨,锦疆140吨），碳铵85吨,硫铵0吨,硝磷铵1704吨,普钙1207吨,钙镁170吨,磷铵112吨,硫酸钾2903吨,氯化钾1654吨,硫酸钾镁517吨,硝酸钾17吨,高含量6220吨,低含量4209吨，其它116吨（明月65吨,金满田32吨,纳若夏19吨）。2、进出口部库存42231吨（磷铵41108吨,磷酸188吨,重钙934吨）。